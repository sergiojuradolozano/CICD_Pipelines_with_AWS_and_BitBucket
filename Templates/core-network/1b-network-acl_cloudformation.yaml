AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  Environment:
    Type: String
    Default: dev
    AllowedValues:
      - dev
      - uat
      - prod
    Description: Enter dev, uat or prod. Default is dev

  Region:
    Type: String
    Default: us-east-1
    AllowedValues:
      - us-east-1
    Description: This value will be replace by the value of the TemplateConfiguration file. The Region from the cli script need to be on the allowed values list.

  Network:
    Type: String
    Default: 10.160
    Description: This value will be replace by the value of the TemplateConfiguration file

Resources:
  InternalSubnetACL:
    Type: AWS::EC2::NetworkAcl
    Properties: 
      VpcId: 
        Fn::ImportValue: 
          !Sub "${Environment}VPC-${AWS::Region}"
      Tags:
        - Key: "Name"
          Value: !Sub "Internal ${Region}b"

  InternalSubnetACLRule1:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      CidrBlock: "0.0.0.0/0"
      Egress: "true"
      Protocol: "-1"
      RuleAction: "allow"
      RuleNumber: "100"
      NetworkAclId: !Ref InternalSubnetACL

  InternalSubnetACLRule2:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      CidrBlock: "0.0.0.0/0"
      Egress: "false"
      Protocol: "-1"
      RuleAction: "allow"
      RuleNumber: "100"
      NetworkAclId: !Ref InternalSubnetACL

  DmzSubnetACL:
    Type: AWS::EC2::NetworkAcl
    Properties: 
      VpcId: 
        Fn::ImportValue: 
          !Sub "${Environment}VPC-${AWS::Region}" 
      Tags:
        - Key: "Name"
          Value: !Sub "DMZ ${Region}b"

  DmzSubnetACLRule1:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      CidrBlock: "0.0.0.0/0"
      Egress: "true"
      Protocol: "-1"
      RuleAction: "allow"
      RuleNumber: "100"
      NetworkAclId: !Ref DmzSubnetACL

  DmzSubnetACLRule2:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      CidrBlock: "0.0.0.0/0"
      Egress: "false"
      Protocol: "-1"
      RuleAction: "allow"
      RuleNumber: "100"
      NetworkAclId: !Ref DmzSubnetACL
      
Outputs:
  DmzSubnetACL:
    Value: !Ref DmzSubnetACL
    Export:
      Name: !Sub "${Environment}DmzSubnetACL-${Region}b"

  InternalSubnetACL:
    Value: !Ref InternalSubnetACL
    Export:
      Name: !Sub "${Environment}InternalSubnetACL-${Region}b"
           
